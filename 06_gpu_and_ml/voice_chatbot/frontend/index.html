<h1>wip</h1>
<div style="position: relative">
  <video
    id="video"
    width="480"
    autoplay
    muted
    style="position: relative; top: 0; left: 0"
  ></video
  ><br />
  <img id="outputImg" style="position: absolute; top: 0; left: 0" />
  <div
    id="message"
    style="position: absolute; top: 0; left: 0; color: red"
  ></div>
</div>

<script type="module">
  import RecorderNode from "./recorder-node.js";

  const onBufferFilled = async (buffer) => {
    // Replace with your API call.
    console.log("API call:", buffer);
  };

  const getNextFrameLoop = async (stream) => {
    const context = new AudioContext();
    const source = context.createMediaStreamSource(stream);

    await context.audioWorklet.addModule("processor.js");
    const recorderNode = new RecorderNode(context, onBufferFilled);

    source.connect(recorderNode);
    recorderNode.connect(context.destination);
  };

  navigator.mediaDevices
    .getUserMedia({ audio: true })
    .then(getNextFrameLoop)
    .catch((e) => {
      message.textContent = e.name + ": " + e.message;
    });
</script>
